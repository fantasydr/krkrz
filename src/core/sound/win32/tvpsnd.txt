全般的に。

文字列をプラグインがわから本体的に返すときは、本体趣ら渡された文字列バッ
ファと、そのサイズ ( ゼロKY文字を含む ) が渡されるので ( ただし例外あり)、
プラグイン趣悉饯挝淖至啸啸氓榨・きzみ、そのサイズを超えてきzんで
はならない。文字コ`ドはワイド文字列を用いる。

URL で、ファイルがロ`カルにある龊悉 file: を省略できる。また、パス区
切りは / を使うこととする。
もちろん、本体趣膝愆`カルファイルのみのサポ`トでもよい。

以下、「サンプルg位」とは、16bit pcm の龊 2byte、8bit pcm の龊悉
1byte を占有する、量子化デ`タのg位である。また、「マルチチャネルサンプル
g位」とは、モノラルの龊 1 サンプルg位、ステレオの龊 2 サンプルg位
を占有する、すべてのチャネルを合わせた量子化デ`タのg位である。


----------------------------------------------------------------------
DLL からエクスポ`トされるもの
これらのv数はメインスレッドからのみ呼ぶ。

HRESULT _stdcall GetModuleInstance(ITSSModule **out, ITSSStorageProvider *provider,
	IStream * config, HWND mainwin);
C能:
	　モジュ`ルのインスタンスの取得
プラグイン:
	　out に ITSSModule のインスタンスを作成するなどして返す。
	　provider には、本体趣违榨ˉぅ毪蜷_くための ITSSStorageProvider イ
	ンタフェ`スが渡されるので、ファイルを_く必要があるときに利用する。
	　config には、このプラグイン用のO定デ`タをhしてある IStream イ
	ンタフェ`スが渡されるが、NULL が渡されたときはO定デ`タは渡されなか
	ったものとしてI理する。
	　mainwin にはアプリケ`ションのメインウィンドウのハンドルが渡され
	ているが、NULL の龊悉猡る。
本体:
	　プラグインを使用するときにこのv数を呼ぶ。out にはプラグインから
	ITSSModule インタフェ`スが渡されるので、使用しKわったら Release
	メソッドで解放する。
	　config には、そのプラグイン用のO定デ`タファイルなどの IStream
	インタフェ`スを渡す ( デ`タはiみzみモ`ドで_けばいい )。面倒な
	ときや、O定デ`タがoい龊悉 NULL を渡してもよい。
	　mainwin にはアプリケ`ションのメインウィンドウのハンドルを渡すが、
	NULL でもよい。
り:
	S_OK : 正常
	それ以外 : 常


ULONG _stdcall GetModuleThreadModel(void)
C能:
	　モジュ`ルのスレッドモデルを得る
プラグイン:
	　*result にスレッドモデルを返す。
		0  シングルスレッドモデル ( リエントラントでない )
		1  アパ`トメントスレッドモデル ( リエントラントである )
	　このv数をエクスポ`トしていないときは、アパ`トメントスレッドモ
	デルであるとなされる。
本体:
	　0 が返された龊悉稀プラグインにして}数のスレッドから同rにア
	クセスできない ( }数スレッドが同rにではなければアクセスすることは
	できる )。
	　1 が返された龊悉稀プラグインにして}数のスレッドから同rにア
	クセスはできるが、一つのオブジェクトにしては}数スレッドから同r
	にアクセスしてはならない。
	　プラグインがこのv数をエクスポ`トしていないときは、アパ`トメン
	トスレッドモデルであるとなす。
り :
	0 : シングルスレッドモデル ( リエントラントでない )
	1 : アパ`トメントスレッドモデル ( リエントラントである )



HRESULT _stdcall ShowConfigWindow([in] HWND parentwin, [in]  IStream * storage );
C能:
	　O定ダイアログの表示
プラグイン:
	　O定ダイアログを表示する。parentwin にはHウィンドウとなるべきウ
	ィンドウのハンドルが渡されるので、活用する。O定がKわったら、storage
	にO定デ`タを格{する。格{形式はプラグインがQめる。
	　O定ダイアログを表示しない龊悉稀このv数をエクスポ`トしなくてよい。
本体:
	　O定ダイアログを表示したいときに呼び出す。parentwin にはHウィン
	ドウとなるべきウィンドウのハンドルを渡す。
	　storage にはO定デ`タを渡すための IStream インタフェ`スを渡す
	( ストリ`ムにきzめる必要がある )。
	　このv数がエクスポ`トされていないときは、O定ダイアログを表示さ
	せることはできない。
り:
	S_OK : 正常
	E_NOTIMPL : g装していない
	それ以外 : 常



ULONG _stdcall CanUnloadNow(void);
C能:
	　プラグインを解放できるかどうかを返す
プラグイン:
	　この DLL をすぐに解放してもよいかを返す。一般的には、内部に参照カ
	ウンタをおき、ITSSModule などのインタフェ`スが作成されたらその参照
	カウンタをインクリメント、削除されればデクリメントして、その参照カ
	ウンタを返せばよい。
本体:
	　プラグインを解放するまえにこのv数でチェックすべき。
	　このv数がエクスポ`トされていないときは、すぐに解放してかまわない。
り:
	0 : 解放可能
	それ以外 : 解放不可


----------------------------------------------------------------------
ITSSModule
プラグインにつき１、必要になるオブジェクト。GetModuleInstance でこの
インタフェ`スを返す。

HRESULT _stdcall GetModuleCopyright([in] LPWSTR buffer, [in] unsigned long buflen );
C能:
	　モジュ`ルの著作厍螭稳〉
プラグイン:
	　プラグインの著作厍螭 buffer にきzむ。buffer のLさは buflen
	( ゼロKY文字を含む ) で与えられているので、これを越えてきzんで
	はならない。
本体:
	　プラグインの著作厍螭必要になれば呼び出す。buffer には文字列バ
	ッファ、buflen にはそのサイズ ( ゼロKY文字を含む ) を与える。
り:
	S_OK : 正常
	E_NOTIMPL : g装していない
	それ以外 : 常


HRESULT _stdcall GetModuleDescription([in] LPWSTR buffer, [in] unsigned long buflen );
C能:
	　モジュ`ルの追加情螭稳〉
プラグイン:
	　GetModuleCopyright と同じ。
本体:
	　プラグインの追加情螭必要になれば呼び出す。そのほかは
	GetModuleCopyright と同じ。
り:
	S_OK : 正常
	E_NOTIMPL : g装していない
	それ以外 : 常


HRESULT _stdcall GetSupportExts([in] unsigned long index, [in] LPWSTR mediashortname, [in] LPWSTR buf, [in] unsigned long buflen );
C能:
	　辚榨ˉぅ子の取得
プラグイン:
	　index には、本体趣ら 0 からに数が渡されるので、その数に
	辘筏骏榨ˉぅ子を返す。辘筏皮い子インデックスを越えて
	呼ばれれば、S_FALSE を返す。
	　mediashortname には、その子に辘工毳幞钎％⒚をきzむため
	のバッファへのポインタが渡される。本体趣扦 char[33] で_保されて
	いるバッファなので、ゼロKY文字を含んで 32 文字まできzむことが
	できる。
	　buf には、ファイル子をきzむ。buflen はバッファL。ファイル
	子は . (ドット) をふくむ。もし、ファイル形式が子によらない
	龊悉稀ドットもなしに空文字を返す ( buf[0]='\0' )。
本体:
	　mediashortname には char[33] で_保したバッファへのポインタを渡す。
	　buf, buflen には、ファイル子が返されるので、MAX_PATH +1 のバ
	ッファLを_保する。
	　index は 0 からはじめ、プラグインが S_FALSE を返すまで 1 を加えつ
	つRり返し呼び出す。ただし、プラグイン趣 S_FALSE を返したときには
	既にインデックスを越えているので、mediashortname , buf には情螭细
	{されていない。
	　buf に空文字列がO定された龊悉稀そのプラグインを蹴ってもよいし、
	GetMediaSupport を呼び出してプラグインにその都度辘虼_Jさせるこ
	ともできる。
り:
	S_OK : 正常 ( 情螭细窦{された )
	S_FALSE : インデックスを越えている ( 情螭细窦{されていない )
	そのほか : 常


HRESULT _stdcall GetMediaInfo([in] LPWSTR url, [out, retval] ITSSMediaBaseInfo ** info );
C能:
	　指定メディアの情螭蛉〉
プラグイン:
	　url にはメディアの存在する鏊 ( Uniform Resource Locator で ) が
	渡される。必要であれば、GetModuleInstance で渡された provider を用
	いてファイルを_き、メディアの内容を得る。
	　info には、作成した ITSSMediaBaseInfo インタフェ`ス、またはその
	派生インタフェ`スを返す。
本体:
	　url にはメディアの存在する鏊を渡す。
	　info には ITSSMediaBaseInfo インタフェ`スが渡されるので、これで
	メディアの情螭虻盲搿Ｊ褂盲方Kわったら Release メソッドで解放するこ
	と。
り:
	S_OK : 正常
	E_NOTIMPL : g装していない ( 情螭系盲椁欷胜 )
	それ以外 : 常


HRESULT _stdcall GetMediaSupport([in] LPWSTR url );
C能:
	　指定メディアをこのプラグインでQえるか
プラグイン:
	　渡された url をmりに、このメディアがQえる形式であるかどうかを
	返す。
本体:
	　メディアがプラグインでQえるかどうかを摔筏郡い趣に、このメソ
	ッドを呼び出す。
り:
	S_OK : 正常
	E_NOTIMPL : g装していない ( GetSupportExts で指定した子を持つ
		ファイルは例外なくiめるんじゃボケ )
	それ以外 : 常


HRESULT _stdcall GetMediaInstance([in] LPWSTR url, [out, retval]  IUnknown ** instance );
C能:
	　メディア再生用オブジェクトの取得
プラグイン:
	　渡された url を再生することのできる再生用オブジェクトを返し、
	instance に返す。
本体:
	　url については GetMediaInfo を参照。
	　プラグインからってくる instance は IUnknown * 型 なので、本体
	で instance->QueryInterface メソッドを呼び出し、どのようなNのメ
	ディア再生用オブジェクトなのかを特定する。F在 ITSSWaveDecoder が
	定されている。
	　instance で返されたオブジェクトを使用しKわったら、Release メソッ
	ドを呼び出して解放する。
り:
	S_OK : 正常
	それ以外 : 常


----------------------------------------------------------------------
ITSSMediaBaseInfo
指定された曲にvする情螭虻盲毪郡幛违ぅ螗骏榨З`ス。
より高度な情螭猡长违ぅ螗骏榨З`スから派生したクラスによって得られる。

HRESULT _stdcall GetMediaType([in] LPWSTR shortname, [in] LPWSTR descbuf, [in] unsigned long descbuflen );
C能:
	　メディアのN文字列の取得
プラグイン:
	　このメディアのNを shortname, descbuf に返す。
	　shortname については、ITSSModule::GetSupportExts の mediashortname
	を参照。
本体:
	　メディアのNにvする情螭虻盲郡い趣にこのメソッドを呼ぶ。
	　shortname については、ITSSModule::GetSupportExts の mediashortname
	を参照。
り:
	S_OK : 正常
	E_NOTIMPL : g装していない
	それ以外 : 常


HRESULT _stdcall GetLength([out, retval] unsigned long * length );
C能:
	　曲Lさの取得
プラグイン:
	　このメディアの曲Lを *length に ms g位で返す。
	　曲Lがわからない龊悉稀メソッドのりとして E_NOTIMPL を返すこ
	と。
本体:
	　メディアの曲Lを得たいときにこのメソッドを呼ぶ。
り:
	S_OK : 正常
	E_NOTIMPL : 曲Lはわからない
	それ以外 : 常

HRESULT _stdcall GetTitle([in] LPWSTR buf, [in] unsigned long buflen );
C能:
	　メディアタイトルの取得


HRESULT _stdcall GetCopyright([in] LPWSTR buf, [in] unsigned long buflen );
C能:
	　メディア著作厍螭稳〉


HRESULT _stdcall GetComment([in] LPWSTR buf, [in] unsigned long buflen );
C能:
	　メディアコメントの取得


HRESULT _stdcall GetArtist([in] LPWSTR buf, [in] unsigned long buflen );
C能:
	　メディアア`ティストの取得


----------------------------------------------------------------------
ITSSWaveDecoder
Wave 形式のファイルをデコ`ドするためのインタフェ`ス。


HRESULT _stdcall GetFormat([in] TSSWaveFormat * format );
C能:
	　再生フォ`マットの取得
プラグイン:
	　format に、このメディアの再生フォ`マットをO定する。
		typedef struct tagTSSWaveFormat
		{
			unsigned long dwSamplesPerSec;
			unsigned long dwChannels;
			unsigned long dwBitsPerSample;
			unsigned long dwSeekable;
			unsigned __int64 ui64TotalSamples; // マルチチャネルサンプルg位
			unsigned long dwTotalTime;
			unsigned long dwReserved0;
			unsigned long dwReserved1;
		} TSSWaveFormat;
	　TSSWaveFormat の dwSeekable フィ`ルドは、サンプル数g位精度でシ
	`ク可能な龊悉 2、ms g位精度でシ`ク可能な龊悉 1、シ`クがで
	きない、あるいはシ`クできても精度がいという龊悉 0 を入れる。
本体:
	　format には TSSWaveFormat へのポインタを渡す。
	　プラグイン趣らフォ`マットが返されるので、再生の浃颏工搿
り:
	S_OK : 正常
	それ以外 : 常


HRESULT _stdcall Render([in] void * buf, [in] unsigned long bufsamplelen, [out] unsigned long * rendered, [out, retval] unsigned long * continue );
C能:
	　F在位置からデコ`ド
プラグイン:
	　F在のデコ`ド位置からデコ`ドをする。
	　デコ`ドの格{先は buf 、格{すべきサンプル数は bufsamplelen でマ
	ルチチャネルサンプルg位で示されている。bufsamplelen はバッファのバ
	イト数ではなく、マルチチャネルサンプル数である。*rendered にはgHに
	デコ`ドしたサンプル数をマルチチャネルサンプルg位で返す。
	　buf が NULL の龊悉铣隽 PCM を格{する必要はない ( スキップ幼 )。
	　continue には、デコ`ドがKわったかどうかのデコ`ダのステ`タスを
	返す。まだデコ`ドをAけられる龊悉 1 を返し、デコ`ドがK了した
	合は 0 を返す。
	　rendered や continue に NULL が渡された龊悉悉长欷椁摔锨螭蚋窦{
	しない。
本体:
	　buf には PCM のサンプルを格{するためのバッファ、bufsamplelen に
	は、そのバッファに格{できる最大サンプル数を渡す。
	　プラグインにスキップの幼鳏蛐肖铯护郡龊悉 buf に NULL、bufsamplelen
	にスキップしたいサンプル数を指定するが、rendered にはgHにスキップ
	されたサンプル数が格{され、それは bufsamplelen よりも少ない龊悉
	ある。
	　rendered にはgHに格{されたサンプル数が渡されるが、bufsamplelen
	よりも小さい龊悉ある。また、小さいからと言ってデコ`ドがKわった
	わけではない。rendered に 0 が返されても、continue が 1 ならば次の
	サンプルをデコ`ドできる。
	　continue が 1 で返ってきたときは、Aけて次のデコ`ドをすることが
	できる。0 で返ってきたときは次のデコ`ドはできない。
り:
	S_OK : 正常
	それ以外 : 常

ド位
HRESULT _stdcall SetPosition([in] unsigned __int64 samplepos );
C能:
	　指定位置へのデコ`ド位置の移
プラグイン:
	　samplepos には、移酉趣挝恢盲マルチチャネルサンプルg位で渡され
	る ( ms g位ではない ) ので、その位置にデコ`ド位置を移婴工搿
	　プラグインによっては、ms g位に精度を丸めて移婴筏皮猡瑜い、推
	Xしない。
本体:
	　シ`クを行うときに呼び出す。
り:
	S_OK : 正常
	E_NOTIMPL : g装していない
	それ以外 : 常


----------------------------------------------------------------------
ITSSStorageProvider
本体趣g装し、GetModuleInstance を呼ぶときにこのインタフェ`スを渡す。
本体趣膝パ`トメントスレッドモデルでこれをg装する必要がある。

HRESULT _stdcall GetStreamForRead([in] LPWSTR url, [out, retval]  IUnknown ** stream );
C能:
	　ストレ`ジのiみzみ用IStreamの取得
プラグイン:
	　このメソッドを用いて、指定 URL のファイルをiみzみモ`ドで_くこ
	とができる。
	　*stream には作成された IStream インタフェ`スが返ってくるので、使
	いKわったら Release する事。
本体:
	　プラグイン趣要求してきたファイルをiみzみモ`ドで_き、その
	IStream インタフェ`スを返す。
り:
	S_OK : 正常
	それ以外 : 常


HRESULT _stdcall GetStreamForWrite([in] LPWSTR url, [out, retval]  IUnknown ** stream );
C能:
	　ストレ`ジのきzみ用IStreamの取得

HRESULT _stdcall GetStreamForUpdate([in] LPWSTR url, [out, retval]  IUnknown ** stream );
C能:
	　ストレ`ジの更新用IStreamの取得

　上二つはg装する必要なし

